<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ç”¨æˆ·ç ”ç©¶ç®¡ç†å·¥å…·</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
html,body{height:100%}
@media print{
  body *{visibility:hidden}
  #printArea, #printArea *{visibility:visible}
  #printArea{position:absolute;left:0;top:0;width:100%;background:#fff}
}
</style>
</head>
<body class="bg-[#F7F7F5] text-black antialiased">
<div class="h-screen flex">
<nav class="w-72 bg-white border-r border-gray-100 flex flex-col">
<div class="px-4 pt-4 pb-3">
<div class="flex items-center gap-2">
<span class="text-2xl">ğŸ“</span>
<div class="text-2xl font-bold">ç”¨æˆ·ç ”ç©¶å·¥ä½œå°</div>
</div>
</div>
<div class="px-4 pb-3 border-b border-gray-100">
<div class="text-sm font-medium">é¡¹ç›®å¯¼èˆª</div>
<button id="goHome" class="mt-2 w-full rounded-md border border-gray-300 bg-white text-gray-700 py-2 text-sm hover:bg-gray-100">é¦–é¡µæ¦‚è§ˆ</button>
<button id="createProject" class="mt-3 w-full rounded-md bg-black text-white py-2 text-sm">æ–°å»ºé¡¹ç›®</button>
</div>
<ul id="projectList" class="flex-1 overflow-y-auto p-2 space-y-1"></ul>
<div class="border-t border-gray-100 p-3 relative">
<button id="aboutBtn" class="absolute -top-10 left-3 z-10 rounded-full border border-gray-200 bg-white text-gray-700 w-8 h-8 shadow flex items-center justify-center hover:bg-gray-50" title="ä½œå“è¯´æ˜">?</button>
<div class="text-xs text-gray-500 mb-2">æ•°æ®å¤‡ä»½ä¸æ¢å¤</div>
<div class="flex items-center gap-2">
<button id="backupBtn" class="text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200">å¤‡ä»½æ•°æ®</button>
<button id="restoreBtn" class="text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200">æ¢å¤æ•°æ®</button>
</div>
<input id="restoreInput" type="file" accept="application/json" class="hidden" />
</div>
</nav>
<main class="flex-1">
<header class="px-6 py-4 border-b border-gray-100">
<div id="currentProjectName" class="text-xl font-medium"></div>
</header>
<section id="contentArea" class="p-6"></section>
</main>
</div>
<script>
const LS_KEY='urmt.projects';
const LS_SELECTED='urmt.selected';
let projects=[];
let selected=null;
let _openTarget=null;
function load(){
 const raw=localStorage.getItem(LS_KEY);
 projects=raw?JSON.parse(raw):[];
 const s=localStorage.getItem(LS_SELECTED);
 selected=s&&s.length?s:null;
 projects.forEach(p=>{
  if(p.title===undefined) p.title=p.name||'';
  if(p.description===undefined) p.description='';
  if(p.insights===undefined) p.insights='';
  if(p.interviews===undefined) p.interviews=[];
  if(p.interviewTemplate===undefined) p.interviewTemplate=[];
   if(p.surveys===undefined) p.surveys=[];
   if(p.focusGroups===undefined) p.focusGroups=[];
   if(p.focusOutlineTemplate===undefined) p.focusOutlineTemplate=[];
   if(p.surveyLastModified===undefined) p.surveyLastModified='';
   if(p.interviewLastModified===undefined) p.interviewLastModified='';
   if(p.focusLastModified===undefined) p.focusLastModified='';
   if(p.updatedAt===undefined) p.updatedAt=Date.now();
   if(p.surveyUpdatedAt===undefined) p.surveyUpdatedAt=0;
   if(p.interviewUpdatedAt===undefined) p.interviewUpdatedAt=0;
   if(p.focusUpdatedAt===undefined) p.focusUpdatedAt=0;
 });
 save();
}
function save(){
 localStorage.setItem(LS_KEY,JSON.stringify(projects));
 localStorage.setItem(LS_SELECTED,selected?selected:'');
}
 function nowMs(){ return Date.now(); }
 function relativeTime(ts){
  if(!ts) return '';
  const diff=Date.now()-ts;
  const m=Math.floor(diff/60000);
  if(m<1) return 'åˆšåˆš';
  if(m<60) return `${m}åˆ†é’Ÿå‰`;
  const h=Math.floor(m/60);
  if(h<24) return `${h}å°æ—¶å‰`;
  const d=Math.floor(h/24);
  if(d===1) return 'æ˜¨å¤©';
  if(d<7) return `${d}å¤©å‰`;
  const dt=new Date(ts);
  const y=dt.getFullYear(), mm=String(dt.getMonth()+1).padStart(2,'0'), dd=String(dt.getDate()).padStart(2,'0');
  return `${y}-${mm}-${dd}`;
 }
function renderProjects(){
 const ul=document.getElementById('projectList');
 ul.innerHTML='';
 const sorted=[...projects].sort((a,b)=>(b.updatedAt||0)-(a.updatedAt||0));
 sorted.forEach(p=>{
  const li=document.createElement('li');
  li.className='group relative flex items-center justify-between rounded-md px-3 py-2 cursor-pointer hover:bg-gray-50';
  const left=document.createElement('div');
  left.className='flex items-start gap-2 flex-1';
  const dot=document.createElement('div');
  dot.className='w-2 h-2 rounded-full bg-gray-300';
  const nameWrap=document.createElement('div');
  nameWrap.className='flex-1 flex flex-col';
  const name=document.createElement('button');
  name.className='text-sm text-left';
  name.textContent=p.name;
  name.onclick=()=>{selected=p.id; save(); render();};
  const sub=document.createElement('div');
  sub.className='text-[10px] text-gray-300';
  sub.textContent=relativeTime(p.updatedAt)||'';
  nameWrap.appendChild(name);
  nameWrap.appendChild(sub);
  left.appendChild(dot);
  left.appendChild(nameWrap);
  const right=document.createElement('div');
  right.className='flex items-center gap-1 opacity-0 group-hover:opacity-100 transition';
  const more=document.createElement('button');
  more.className='text-xs px-2 py-1 rounded border border-gray-200 bg-white text-gray-600 hover:bg-gray-100';
  more.textContent='â‹®';
  const menu=document.createElement('div');
  menu.className='hidden absolute z-50 right-2 top-full mt-1 w-32 rounded-md border border-gray-200 bg-white shadow-lg';
  const itemRename=document.createElement('button');
  itemRename.className='w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50';
  itemRename.textContent='é‡å‘½å';
  itemRename.onclick=(e)=>{
    e.stopPropagation();
    const val=prompt('é‡å‘½åé¡¹ç›®',p.name);
    if(val&&val.trim()){
      p.name=val.trim();
      save(); render();
    }
    menu.classList.add('hidden');
  };
  const itemDelete=document.createElement('button');
  itemDelete.className='w-full text-left px-3 py-2 text-xs hover:bg-gray-50 text-red-600';
  itemDelete.textContent='åˆ é™¤';
  itemDelete.onclick=(e)=>{
    e.stopPropagation();
    if(confirm('ç¡®å®šè¦åˆ é™¤è¯¥é¡¹ç›®åŠæ‰€æœ‰ç ”ç©¶è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')){
      projects=projects.filter(x=>x.id!==p.id);
      if(selected===p.id) selected=null;
      save(); render();
    }
    menu.classList.add('hidden');
  };
  menu.appendChild(itemRename);
  menu.appendChild(itemDelete);
  more.onclick=(e)=>{
    e.stopPropagation();
    if(menu.classList.contains('hidden')){
      menu.classList.remove('hidden');
      const onWinClick=(ev)=>{
        if(!menu.contains(ev.target) && ev.target!==more){
          menu.classList.add('hidden');
          window.removeEventListener('click', onWinClick);
        }
      };
      window.addEventListener('click', onWinClick);
    }else{
      menu.classList.add('hidden');
    }
  };
  right.appendChild(more);
  li.appendChild(left);
  li.appendChild(right);
  li.appendChild(menu);
  ul.appendChild(li);
 });
}
function createInfoCard(label,field,placeholder){
 const proj=projects.find(x=>x.id===selected);
 const card=document.createElement('div');
 card.className='rounded-lg border border-gray-200 bg-gray-50 p-4';
 const head=document.createElement('div');
 head.className='flex items-center justify-between mb-2';
 const t=document.createElement('div');
 t.className='text-sm font-medium';
 t.textContent=label;
 const btn=document.createElement('button');
 btn.className='text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 btn.textContent='ç¼–è¾‘';
 head.appendChild(t);
 head.appendChild(btn);
 const display=document.createElement('div');
 const val=proj[field]||'';
 display.className=val.trim()? 'text-sm leading-6 text-gray-700' : 'text-sm leading-6 text-gray-400';
 display.textContent=val.trim()? val : placeholder;
 const ta=document.createElement('textarea');
 ta.className='hidden w-full mt-2 rounded border border-gray-200 bg-white p-2 text-sm leading-6';
 ta.value=val;
 ta.placeholder=placeholder;
 let editing=false;
 btn.onclick=()=>{
  editing=!editing;
  if(editing){
   btn.textContent='å®Œæˆ';
   display.classList.add('hidden');
   ta.classList.remove('hidden');
   ta.focus();
  }else{
   btn.textContent='ç¼–è¾‘';
   display.classList.remove('hidden');
   ta.classList.add('hidden');
   const v=ta.value.trim();
   proj[field]=v;
   save();
   display.textContent=v? v : placeholder;
   display.className=v? 'text-sm leading-6 text-gray-700' : 'text-sm leading-6 text-gray-400';
  }
 };
 ta.oninput=()=>{
  proj[field]=ta.value;
  save();
 };
 card.appendChild(head);
 card.appendChild(display);
 card.appendChild(ta);
 return card;
}
function renderHeaderTitle(proj){
 const header=document.getElementById('currentProjectName');
 header.innerHTML='';
 const wrap=document.createElement('div');
 wrap.className='flex items-center gap-2';
 const nameSpan=document.createElement('span');
 nameSpan.className='text-xl font-medium';
 nameSpan.textContent=(proj.title||proj.name||'');
 const editBtn=document.createElement('button');
 editBtn.className='rounded-md bg-transparent border border-transparent text-gray-500 px-2 py-1 text-xs hover:text-gray-700';
 editBtn.textContent='âœï¸';
 const input=document.createElement('input');
 input.className='hidden text-xl font-medium bg-white border border-gray-300 rounded px-2 py-1';
 input.value=(proj.title||proj.name||'');
 let editing=false;
 editBtn.onclick=()=>{
  editing=!editing;
  if(editing){
   nameSpan.classList.add('hidden');
   input.classList.remove('hidden');
   input.focus();
  }else{
   nameSpan.classList.remove('hidden');
   input.classList.add('hidden');
   const v=input.value.trim();
   proj.title=v||proj.name||'';
   save(); render();
  }
 };
 input.oninput=()=>{
  proj.title=input.value;
  save();
 };
 wrap.appendChild(nameSpan);
 wrap.appendChild(editBtn);
 wrap.appendChild(input);
 header.appendChild(wrap);
}
function renderContent(){
 const title=document.getElementById('currentProjectName');
 const area=document.getElementById('contentArea');
 if(!selected){
  title.textContent='';
  area.innerHTML='';
  const wrap=document.createElement('div');
  wrap.className='max-w-3xl mx-auto';
  const searchBox=document.createElement('div');
  searchBox.className='flex items-center gap-2 rounded-md border border-gray-300 bg-white px-3 py-2';
  const icon=document.createElement('span');
  icon.textContent='ğŸ”';
  const input=document.createElement('input');
  input.className='flex-1 outline-none text-sm';
  input.placeholder='æœç´¢è®¿è°ˆã€é—®å·æˆ–ç„¦ç‚¹å°ç»„å†…å®¹...';
  searchBox.appendChild(icon);
  searchBox.appendChild(input);
  const results=document.createElement('div');
  results.className='mt-4 space-y-2';
  function renderDashboard(){
    results.innerHTML='';
    const pCount=projects.length;
    let iCount=0; let sCount=0;
    projects.forEach(p=>{ iCount+=(p.interviews||[]).length; sCount+=(p.surveys||[]).length; });
    const stats=document.createElement('div');
    stats.className='grid grid-cols-1 md:grid-cols-3 gap-3';
    const statCard=(label,value)=>{
      const d=document.createElement('div');
      d.className='rounded-lg border border-gray-200 bg-white p-4';
      d.innerHTML=`<div class="text-xs text-gray-500">${label}</div><div class="mt-1 text-2xl font-semibold">${value}</div>`;
      return d;
    };
    stats.appendChild(statCard('é¡¹ç›®æ€»æ•°',pCount));
    stats.appendChild(statCard('ç´¯è®¡è®¿è°ˆ',iCount));
    stats.appendChild(statCard('ç´¯è®¡é—®å·',sCount));
    results.appendChild(stats);
    const board=document.createElement('div');
    board.className='mt-6 rounded-lg border border-gray-200 bg-white p-4';
    const title=document.createElement('div');
    title.className='text-sm font-medium mb-3';
    title.textContent='é¡¹ç›®è¿›åº¦çœ‹æ¿';
    board.appendChild(title);
    const list=document.createElement('div');
    list.className='space-y-3';
    function calcProgress(p){
      let pct=0;
      if((p.description||'').trim()) pct+=10;
      if((p.insights||'').trim()) pct+=10;
      pct+=Math.min(((p.interviews||[]).length)*20,60);
      pct+=Math.min(((p.surveys||[]).length)*20,20);
      return Math.min(pct,100);
    }
    projects.forEach(p=>{
      const row=document.createElement('button');
      row.className='w-full text-left rounded-md border border-gray-100 bg-white px-3 py-2 hover:border-gray-200';
      const top=document.createElement('div');
      top.className='text-sm font-medium';
      top.textContent=p.name;
      const barWrap=document.createElement('div');
      barWrap.className='mt-2 h-1.5 rounded bg-gray-200';
      const fill=document.createElement('div');
      fill.className='h-1.5 rounded bg-black';
      const pct=calcProgress(p);
      fill.style.width=pct+'%';
      barWrap.appendChild(fill);
      row.appendChild(top);
      row.appendChild(barWrap);
      row.onclick=()=>{ selected=p.id; save(); render(); };
      list.appendChild(row);
    });
    board.appendChild(list);
    results.appendChild(board);
    const activity=document.createElement('div');
    activity.className='mt-6 rounded-lg border border-gray-200 bg-white p-4';
    const atitle=document.createElement('div');
    atitle.className='text-sm font-medium mb-3';
    atitle.textContent='æœ€è¿‘æ´»åŠ¨';
    activity.appendChild(atitle);
    const items=[];
    projects.forEach(p=>{
      if(p.interviewUpdatedAt) items.push({ts:p.interviewUpdatedAt, text:`æ›´æ–°äº†è®¿è°ˆ Â· ${p.name}`});
      if(p.surveyUpdatedAt) items.push({ts:p.surveyUpdatedAt, text:`æ›´æ–°äº†é—®å· Â· ${p.name}`});
      if(p.focusUpdatedAt) items.push({ts:p.focusUpdatedAt, text:`æ›´æ–°äº†ç„¦ç‚¹å°ç»„ Â· ${p.name}`});
    });
    items.sort((a,b)=>b.ts-a.ts);
    const recent=items.slice(0,3);
    if(recent.length===0){
      const none=document.createElement('div');
      none.className='text-xs text-gray-500';
      none.textContent='æš‚æ— æœ€è¿‘æ´»åŠ¨';
      activity.appendChild(none);
    }else{
      recent.forEach(it=>{
        const line=document.createElement('div');
        line.className='flex items-center justify-between text-sm';
        const t=document.createElement('div');
        t.textContent=it.text;
        const r=document.createElement('div');
        r.className='text-xs text-gray-400';
        r.textContent=relativeTime(it.ts);
        line.appendChild(t);
        line.appendChild(r);
        activity.appendChild(line);
      });
    }
    results.appendChild(activity);
  }
  function search(q){
    const query=q.trim().toLowerCase();
    results.innerHTML='';
    if(!query){ renderDashboard(); return; }
    const items=[];
    projects.forEach(p=>{
      (p.interviews||[]).forEach(it=>{
        const texts=[it.name||'', it.background||'', it.pain||'', it.remark||''];
        (it.notes||[]).forEach(n=>{ texts.push(n.question||'', n.answer||''); });
        const hit=texts.some(t=>String(t).toLowerCase().includes(query));
        if(hit) items.push({project:p, type:'interview', title:it.name||it.date||'è®¿è°ˆ', id:it.id});
      });
      (p.surveys||[]).forEach(sv=>{
        const texts=[sv.name||'', sv.insights||''];
        const hit=texts.some(t=>String(t).toLowerCase().includes(query));
        if(hit) items.push({project:p, type:'survey', title:sv.name||'é—®å·', id:sv.id});
      });
      (p.focusGroups||[]).forEach(fg=>{
        const texts=[fg.topic||'', (fg.records&&fg.records.consensus)||'', (fg.records&&fg.records.collision)||'', (fg.records&&fg.records.quotes)||''];
        const hit=texts.some(t=>String(t).toLowerCase().includes(query));
        if(hit) items.push({project:p, type:'focus', title:fg.name||fg.topic||'ç„¦ç‚¹å°ç»„', id:fg.id});
      });
    });
    if(items.length===0){
      const empty=document.createElement('div');
      empty.className='text-xs text-gray-500';
      empty.textContent='æœªæ‰¾åˆ°ç›¸å…³å†…å®¹';
      results.appendChild(empty);
      return;
    }
    items.forEach(r=>{
      const card=document.createElement('button');
      card.className='w-full text-left rounded-lg border border-gray-200 bg-white px-3 py-2 hover:border-gray-300';
      const typeLabel=r.type==='interview'?'è®¿è°ˆ':(r.type==='survey'?'é—®å·':'ç„¦ç‚¹å°ç»„');
      card.innerHTML=`<div class="text-sm font-medium">${r.project.name} > ${typeLabel} > ${r.title}</div>`;
      card.onclick=()=>{
        selected=r.project.id; _openTarget={type:r.type,id:r.id}; save();
        openCategory({key:r.type,label:typeLabel,desc:''});
      };
      results.appendChild(card);
    });
  }
  input.oninput=()=>search(input.value);
  wrap.appendChild(searchBox);
  wrap.appendChild(results);
  area.appendChild(wrap);
  renderDashboard();
  return;
 }
 const proj=projects.find(x=>x.id===selected);
 renderHeaderTitle(proj);
 area.innerHTML='';
 const info=document.createElement('div');
 info.className='grid grid-cols-1 md:grid-cols-2 gap-4 mb-6';
 info.appendChild(createInfoCard('é¡¹ç›®ç®€ä»‹','description','ç‚¹å‡»æ·»åŠ é¡¹ç›®ç®€ä»‹...'));
 info.appendChild(createInfoCard('åˆæ­¥ç»“è®º','insights','ç‚¹å‡»æ·»åŠ åˆæ­¥ç»“è®º...'));
 area.appendChild(info);
 const grid=document.createElement('div');
 grid.className='grid grid-cols-1 sm:grid-cols-3 gap-4';
 const folders=[
  {key:'survey',label:'é—®å·',desc:'è¿™é‡Œæ˜¯é—®å·åˆ—è¡¨'},
  {key:'interview',label:'è®¿è°ˆ',desc:'è¿™é‡Œæ˜¯è®¿è°ˆåˆ—è¡¨'},
  {key:'focus',label:'ç„¦ç‚¹å°ç»„',desc:'è¿™é‡Œæ˜¯ç„¦ç‚¹å°ç»„åˆ—è¡¨'}
 ];
 folders.forEach(f=>{
  const card=document.createElement('button');
  card.className='rounded-lg border border-gray-200 bg-white p-5 text-left hover:border-gray-300 hover:shadow-sm';
  let lm='';
  if(f.key==='survey') lm=proj.surveyLastModified||'';
  else if(f.key==='interview') lm=proj.interviewLastModified||'';
  else if(f.key==='focus') lm=proj.focusLastModified||'';
  const lmText=lm && lm.trim()? ('æœ€åæ›´æ–°ï¼š'+lm) : 'æœ€åæ›´æ–°ï¼šæš‚æ— è®°å½•';
  card.innerHTML='<div class="text-base font-medium">'+f.label+'</div><div class="mt-1 text-xs text-gray-500">Folder</div><div class="mt-1 text-xs text-gray-400">'+lmText+'</div>';
  card.onclick=()=>openCategory(f);
  grid.appendChild(card);
 });
 area.appendChild(grid);
}
function openCategory(f){
 const area=document.getElementById('contentArea');
 area.innerHTML='';
 const toolbar=document.createElement('div');
 toolbar.className='mb-4 flex items-center justify-between';
 const back=document.createElement('button');
 back.className='rounded-md border border-gray-200 bg-white px-3 py-1.5 text-sm hover:bg-gray-100';
 back.textContent='è¿”å›';
 back.onclick=()=>renderContent();
 const title=document.createElement('div');
 title.className='text-base font-medium';
 title.textContent=f.label;
 toolbar.appendChild(back);
 toolbar.appendChild(title);
 area.appendChild(toolbar);
 const proj=projects.find(x=>x.id===selected);
  if(f.key==='interview'){
   renderInterviewCategory(area, proj);
  }else if(f.key==='survey'){
   renderSurveyCategory(area, proj);
  }else if(f.key==='focus'){
   renderFocusGroupCategory(area, proj);
  }else{
   const box=document.createElement('div');
   box.className='rounded-lg border border-gray-200 bg-white p-6';
   box.textContent=f.desc;
   area.appendChild(box);
 }
}
function renderFocusGroupCategory(root, proj){
 const container=document.createElement('div');
 container.className='grid grid-cols-1 lg:grid-cols-3 gap-4';
 const listBox=document.createElement('div');
 listBox.className='lg:col-span-1 rounded-lg border border-gray-200 bg-white p-4';
 const listHead=document.createElement('div');
 listHead.className='flex items-center justify-between mb-3';
 const listTitle=document.createElement('div');
 listTitle.className='text-sm font-medium';
 listTitle.textContent='ç„¦ç‚¹å°ç»„';
 const headActions=document.createElement('div');
 headActions.className='flex items-center gap-2';
 const outlineBtn=document.createElement('button');
 outlineBtn.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 outlineBtn.textContent='ç¼–è¾‘é»˜è®¤æçº²';
 const addBtn=document.createElement('button');
 addBtn.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 addBtn.textContent='æ–°å¢ç„¦ç‚¹å°ç»„';
 listHead.appendChild(listTitle);
 headActions.appendChild(outlineBtn);
 headActions.appendChild(addBtn);
 listHead.appendChild(headActions);
 const list=document.createElement('div');
 list.className='space-y-2';
 listBox.appendChild(listHead);
 listBox.appendChild(list);
 const formBox=document.createElement('div');
 formBox.className='lg:col-span-2 rounded-lg border border-gray-200 bg-gray-50 p-4';
 const formHead=document.createElement('div');
 formHead.className='flex items-center justify-between mb-3';
 const formTitle=document.createElement('div');
 formTitle.className='text-sm font-medium';
 formTitle.textContent='å°ç»„è¯¦æƒ…';
 const exportGroup=document.createElement('div');
 exportGroup.className='export-group flex items-center gap-2';
 const exportMD=document.createElement('button');
 exportMD.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 exportMD.textContent='ğŸ“¥ å¯¼å‡º MD';
 const exportDOC=document.createElement('button');
 exportDOC.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 exportDOC.textContent='ğŸ“ å¯¼å‡º Word';
 const exportPDF=document.createElement('button');
 exportPDF.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 exportPDF.textContent='ğŸ–¨ï¸ æ‰“å°/å¯¼å‡º PDF';
 formHead.appendChild(formTitle);
 exportGroup.appendChild(exportMD);
 exportGroup.appendChild(exportDOC);
 exportGroup.appendChild(exportPDF);
 formHead.appendChild(exportGroup);
 formBox.appendChild(formHead);
 const form=document.createElement('div');
 form.className='space-y-4';
 formBox.appendChild(form);
 const printArea=document.createElement('div');
 printArea.id='printArea';
 printArea.className='hidden';
 formBox.appendChild(printArea);
 container.appendChild(listBox);
 container.appendChild(formBox);
 root.appendChild(container);
 let editingId=null;
 function input(cls, placeholder){
   const i=document.createElement('input');
   i.className=cls || 'w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
   if(placeholder) i.placeholder=placeholder;
   return i;
 }
 function textarea(cls, placeholder){
   const t=document.createElement('textarea');
   t.className=cls || 'w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
   if(placeholder) t.placeholder=placeholder;
   return t;
 }
 function today(){
   const d=new Date();
   const yyyy=d.getFullYear();
   const mm=String(d.getMonth()+1).padStart(2,'0');
   const dd=String(d.getDate()).padStart(2,'0');
   return `${yyyy}-${mm}-${dd}`;
 }
 function openOutlineModal(){
   const overlay=document.createElement('div');
   overlay.className='fixed inset-0 bg-black/20 flex items-center justify-center z-50';
   const panel=document.createElement('div');
   panel.className='w-full max-w-lg rounded-lg border border-gray-200 bg-white p-4';
   const title=document.createElement('div');
   title.className='text-sm font-medium mb-2';
   title.textContent='ç¼–è¾‘é»˜è®¤æçº²ï¼ˆæ¯è¡Œä¸€ä¸ªé—®é¢˜ï¼‰';
   const ta=document.createElement('textarea');
   ta.className='w-full h-48 rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
   ta.value=(proj.focusOutlineTemplate||[]).join('\n');
   const actions=document.createElement('div');
   actions.className='mt-3 flex items-center justify-end gap-2';
   const cancel=document.createElement('button');
   cancel.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   cancel.textContent='å–æ¶ˆ';
   const saveBtn=document.createElement('button');
   saveBtn.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   saveBtn.textContent='ä¿å­˜';
   actions.appendChild(cancel);
   actions.appendChild(saveBtn);
   panel.appendChild(title);
   panel.appendChild(ta);
   panel.appendChild(actions);
   overlay.appendChild(panel);
   document.body.appendChild(overlay);
   cancel.onclick=()=>{ document.body.removeChild(overlay); };
   saveBtn.onclick=()=>{
     const lines=ta.value.split('\n').map(x=>x.trim()).filter(x=>x.length>0);
     proj.focusOutlineTemplate=lines;
     save();
     document.body.removeChild(overlay);
   };
 }
 function safeText(s){ return (s||'').replace(/</g,'&lt;'); }
 function exportMarkdownFG(current){
   const n=current.name && current.name.trim()? current.name.trim(): 'æœªå‘½å';
   const d=current.date && current.date.trim()? current.date.trim(): today();
   const locType=current.locationType||'';
   const locDetail=current.locationDetail||'';
   const duration=current.duration||'';
   const host=current.host||'';
   const parts=(current.participants||[]);
   const outline=(current.outline||[]);
   const rec=current.records||{};
   let md=`# ç„¦ç‚¹å°ç»„è®°å½•ï¼š${n}\n\n`;
   md+=`æ—¥æœŸï¼š${d}\n`;
   md+=`åœ°ç‚¹ï¼š${locType} ${locDetail}\n`;
   md+=`æ—¶é•¿ï¼š${duration}\n`;
   md+=`ä¸»æŒäººï¼š${host}\n\n`;
   md+=`å‚ä¸è€…åå•\n`;
   if(parts.length){
     md+=`| å§“å | èº«ä»½ | ç‰¹å¾ |\n| --- | --- | --- |\n`;
     parts.forEach(p=>{ md+=`| ${(p.name||'')} | ${(p.tag||'')} | ${(p.traits||'')} |\n`; });
     md+=`\n`;
   }else{
     md+=`æ— \n\n`;
   }
   md+=`è®¨è®ºæçº²\n`;
   if(outline.length){
     outline.forEach(q=>{ md+=`- ${q}\n`; });
     md+=`\n`;
   }else{
     md+=`æ— \n\n`;
   }
   md+=`## è§‚ç‚¹ç¢°æ’\n`;
   md+=`${(rec.collision&&rec.collision.trim())? rec.collision.trim() : 'æ— '}\n\n`;
   md+=`## å…±è¯†æ€»ç»“\n`;
   md+=`${(rec.consensus&&rec.consensus.trim())? rec.consensus.trim() : 'æ— '}\n\n`;
   md+=`## ç²¾å½©é‡‘å¥\n`;
   if(rec.quotes && rec.quotes.trim()){
     const lines=rec.quotes.split('\n').map(l=>l.trim()).filter(l=>l.length>0);
     lines.forEach(l=>{ md+=`> ${l}\n`; });
     md+=`\n`;
   }else{
     md+=`æ— \n`;
   }
   const safeName=s=>s.replace(/[\\/:*?"<>|]/g,'_');
   const fname=`ç„¦ç‚¹å°ç»„_${safeName(n)}_${safeName(d)}.md`;
   const blob=new Blob([md],{type:'text/markdown;charset=utf-8'});
   const url=URL.createObjectURL(blob);
   const a=document.createElement('a');
   a.href=url; a.download=fname;
   document.body.appendChild(a); a.click(); a.remove();
   URL.revokeObjectURL(url);
 }
 function exportWordFG(current){
   const n=current.name && current.name.trim()? current.name.trim(): 'æœªå‘½å';
   const d=current.date && current.date.trim()? current.date.trim(): today();
   const safeName=s=>s.replace(/[\\/:*?"<>|]/g,'_');
   const fname=`ç„¦ç‚¹å°ç»„_${safeName(n)}_${safeName(d)}.doc`;
   const parts=(current.participants||[]);
   const outline=(current.outline||[]);
   const rec=current.records||{};
   const tableRows=parts.map(p=>`<tr><td>${safeText(p.name)}</td><td>${safeText(p.tag)}</td><td>${safeText(p.traits)}</td></tr>`).join('');
   const outlineList=outline.map(q=>`<li>${safeText(q)}</li>`).join('');
   const quotesHTML=(rec.quotes||'').split('\n').map(l=>l.trim()).filter(l=>l.length>0).map(l=>`<blockquote>${safeText(l)}</blockquote>`).join('');
   const html=`<!doctype html><html><head><meta charset="utf-8"><title>ç„¦ç‚¹å°ç»„</title>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei","Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;line-height:1.6}
h1{font-size:20px;font-weight:700;margin:0 0 8px}
h2{font-size:16px;font-weight:700;margin:16px 0 6px}
p{margin:6px 0}
table{width:100%;border-collapse:collapse;margin:8px 0}
td,th{border:1px solid #e5e7eb;padding:6px;font-size:12px}
.block{margin:10px 0;padding:8px;border:1px solid #e5e7eb;border-radius:6px;background:#fafafa}
blockquote{border-left:3px solid #e5e7eb;padding:6px 8px;margin:6px 0;background:#fbfbfb}
</style></head><body>
<h1>ç„¦ç‚¹å°ç»„è®°å½•ï¼š${safeText(n)}</h1>
<p>æ—¥æœŸï¼š${safeText(d)}</p>
<p>åœ°ç‚¹ï¼š${safeText(current.locationType||'')} ${safeText(current.locationDetail||'')}</p>
<p>æ—¶é•¿ï¼š${safeText(current.duration||'')}</p>
<p>ä¸»æŒäººï¼š${safeText(current.host||'')}</p>
<h2>å‚ä¸è€…åå•</h2>
${parts.length? `<table><thead><tr><th>å§“å</th><th>èº«ä»½</th><th>ç‰¹å¾</th></tr></thead><tbody>${tableRows}</tbody></table>` : '<p>æ— </p>'}
<h2>è®¨è®ºæçº²</h2>
${outline.length? `<ul>${outlineList}</ul>` : '<p>æ— </p>'}
<div class="block"><h2>è§‚ç‚¹ç¢°æ’</h2><p>${safeText(rec.collision||'æ— ')}</p></div>
<div class="block"><h2>å…±è¯†æ€»ç»“</h2><p>${safeText(rec.consensus||'æ— ')}</p></div>
<div class="block"><h2>ç²¾å½©é‡‘å¥</h2>${quotesHTML || '<p>æ— </p>'}</div>
</body></html>`;
   const blob=new Blob([html],{type:'application/msword;charset=utf-8'});
   const url=URL.createObjectURL(blob);
   const a=document.createElement('a');
   a.href=url; a.download=fname;
   document.body.appendChild(a); a.click(); a.remove();
   URL.revokeObjectURL(url);
 }
 function buildPrintHTMLFG(current){
   const n=current.name && current.name.trim()? current.name.trim(): 'æœªå‘½å';
   const d=current.date && current.date.trim()? current.date.trim(): today();
   const parts=(current.participants||[]);
   const outline=(current.outline||[]);
   const rec=current.records||{};
   const tableRows=parts.map(p=>`<tr><td>${safeText(p.name)}</td><td>${safeText(p.tag)}</td><td>${safeText(p.traits)}</td></tr>`).join('');
   const outlineList=outline.map(q=>`<li>${safeText(q)}</li>`).join('');
   const quotesHTML=(rec.quotes||'').split('\n').map(l=>l.trim()).filter(l=>l.length>0).map(l=>`<blockquote>${safeText(l)}</blockquote>`).join('');
   const pa=document.getElementById('printArea');
   if(!pa) return;
   pa.innerHTML=`
   <div style="padding:24px;font-family:-apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei','Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif">
     <h1 style="font-size:20px;font-weight:700;margin:0 0 8px">ç„¦ç‚¹å°ç»„è®°å½•ï¼š${safeText(n)}</h1>
     <p>æ—¥æœŸï¼š${safeText(d)}</p>
     <p>åœ°ç‚¹ï¼š${safeText(current.locationType||'')} ${safeText(current.locationDetail||'')}</p>
     <p>æ—¶é•¿ï¼š${safeText(current.duration||'')}</p>
     <p>ä¸»æŒäººï¼š${safeText(current.host||'')}</p>
     <h2 style="font-size:16px;font-weight:700;margin:16px 0 6px">å‚ä¸è€…åå•</h2>
     ${parts.length? `<table style="width:100%;border-collapse:collapse;margin:8px 0"><thead><tr><th style="border:1px solid #e5e7eb;padding:6px;font-size:12px">å§“å</th><th style="border:1px solid #e5e7eb;padding:6px;font-size:12px">èº«ä»½</th><th style="border:1px solid #e5e7eb;padding:6px;font-size:12px">ç‰¹å¾</th></tr></thead><tbody>${tableRows}</tbody></table>` : '<p>æ— </p>'}
     <h2 style="font-size:16px;font-weight:700;margin:16px 0 6px">è®¨è®ºæçº²</h2>
     ${outline.length? `<ul>${outlineList}</ul>` : '<p>æ— </p>'}
     <div style="margin:10px 0;padding:8px;border:1px solid #e5e7eb;border-radius:6px;background:#fafafa">
       <h2 style="font-size:16px;font-weight:700;margin:0 0 6px">è§‚ç‚¹ç¢°æ’</h2>
       <p>${safeText(rec.collision||'æ— ')}</p>
     </div>
     <div style="margin:10px 0;padding:8px;border:1px solid #e5e7eb;border-radius:6px;background:#fafafa">
       <h2 style="font-size:16px;font-weight:700;margin:0 0 6px">å…±è¯†æ€»ç»“</h2>
       <p>${safeText(rec.consensus||'æ— ')}</p>
     </div>
     <div style="margin:10px 0;padding:8px;border:1px solid #e5e7eb;border-radius:6px;background:#fafafa">
       <h2 style="font-size:16px;font-weight:700;margin:0 0 6px">ç²¾å½©é‡‘å¥</h2>
       ${quotesHTML || '<p>æ— </p>'}
     </div>
   </div>`;
 }
 function renderList(){
   list.innerHTML='';
   (proj.focusGroups||[]).forEach(item=>{
     const row=document.createElement('div');
     row.className='rounded border border-gray-200 px-3 py-2 hover:bg-gray-50';
     const top=document.createElement('div');
     top.className='flex items-center justify-between';
     const left=document.createElement('div');
     left.className='flex items-center gap-2';
     const nameBtn=document.createElement('button');
     nameBtn.className='text-sm font-medium';
     nameBtn.textContent=item.name||'æœªå‘½åå°ç»„';
     nameBtn.onclick=()=>{ loadForm(item.id); };
     const metaSmall=document.createElement('div');
     metaSmall.className='text-xs text-gray-500';
     metaSmall.textContent=`${item.date||'-'} Â· å‚ä¸äººæ•°ï¼š${(item.participants||[]).length||item.participantCount||0} Â· ä¸»æŒäººï¼š${item.host||'-'}`;
     left.appendChild(nameBtn);
     left.appendChild(metaSmall);
     top.appendChild(left);
     row.appendChild(top);
     list.appendChild(row);
   });
   if(!proj.focusGroups||proj.focusGroups.length===0){
     const empty=document.createElement('div');
     empty.className='text-xs text-gray-500';
     empty.textContent='æš‚æ— ç„¦ç‚¹å°ç»„ï¼Œç‚¹å‡»â€œæ–°å¢ç„¦ç‚¹å°ç»„â€å¼€å§‹æ·»åŠ ã€‚';
     list.appendChild(empty);
   }
 }
 function loadForm(id){
   form.innerHTML='';
   let data;
   if(id){
     data=proj.focusGroups.find(x=>x.id===id);
     editingId=id;
   }else{
     const templ=(proj.focusOutlineTemplate||[]);
     data={id:String(Date.now()),name:'',date:today(),host:'',topic:'',locationType:'çº¿ä¸Š',locationDetail:'',duration:'',participants:[],outline:(templ.length? templ.map(q=>q):[]),records:{collision:'',consensus:'',quotes:''}};
     editingId=null;
   }
   const baseWrap=document.createElement('div');
   baseWrap.className='grid grid-cols-1 md:grid-cols-2 gap-3 rounded-md bg-gray-50 p-3';
   const nameField=document.createElement('div');
   const nameLabel=document.createElement('div');
   nameLabel.className='text-xs text-gray-600';
   nameLabel.textContent='å°ç»„åç§°';
   const nameInput=input();
   nameInput.value=data.name||'';
   nameInput.oninput=()=>{ data.name=nameInput.value; };
   nameField.appendChild(nameLabel);
   nameField.appendChild(nameInput);
   const dateField=document.createElement('div');
   const dateLabel=document.createElement('div');
   dateLabel.className='text-xs text-gray-600';
   dateLabel.textContent='æ—¥æœŸ';
   const dateInput=input();
   dateInput.type='date';
   dateInput.value=data.date||today();
   dateInput.oninput=()=>{ data.date=dateInput.value; };
   dateField.appendChild(dateLabel);
   dateField.appendChild(dateInput);
   baseWrap.appendChild(nameField);
   baseWrap.appendChild(dateField);
   const infoWrap=document.createElement('div');
   infoWrap.className='grid grid-cols-1 md:grid-cols-3 gap-3 rounded-md bg-gray-50 p-3';
   const topicField=document.createElement('div');
   const topicLabel=document.createElement('div');
   topicLabel.className='text-xs text-gray-600';
   topicLabel.textContent='å°ç»„ä¸»é¢˜';
   const topicInput=input();
   topicInput.value=data.topic||'';
   topicInput.oninput=()=>{ data.topic=topicInput.value; };
   topicField.appendChild(topicLabel);
   topicField.appendChild(topicInput);
   const locTypeField=document.createElement('div');
   const locTypeLabel=document.createElement('div');
   locTypeLabel.className='text-xs text-gray-600';
   locTypeLabel.textContent='åœ°ç‚¹ç±»å‹';
   const locTypeSelect=document.createElement('select');
   locTypeSelect.className='w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
   ['çº¿ä¸Š','çº¿ä¸‹'].forEach(s=>{ const opt=document.createElement('option'); opt.value=s; opt.textContent=s; locTypeSelect.appendChild(opt); });
   locTypeSelect.value=data.locationType||'çº¿ä¸Š';
   locTypeSelect.oninput=()=>{ data.locationType=locTypeSelect.value; };
   locTypeField.appendChild(locTypeLabel);
   locTypeField.appendChild(locTypeSelect);
   const durationField=document.createElement('div');
   const durationLabel=document.createElement('div');
   durationLabel.className='text-xs text-gray-600';
   durationLabel.textContent='æ—¶é•¿';
   const durationInput=input();
   durationInput.placeholder='ä¾‹å¦‚ï¼š90 åˆ†é’Ÿ';
   durationInput.value=data.duration||'';
   durationInput.oninput=()=>{ data.duration=durationInput.value; };
   durationField.appendChild(durationLabel);
   durationField.appendChild(durationInput);
   infoWrap.appendChild(topicField);
   infoWrap.appendChild(locTypeField);
   infoWrap.appendChild(durationField);
   const locDetailField=document.createElement('div');
   locDetailField.className='rounded-md bg-gray-50 p-3';
   const locDetailLabel=document.createElement('div');
   locDetailLabel.className='text-xs text-gray-600';
   locDetailLabel.textContent='åœ°ç‚¹ï¼ˆçº¿ä¸Šä¼šè®®é“¾æ¥æˆ–çº¿ä¸‹åœ°å€ï¼‰';
   const locDetailInput=input();
   locDetailInput.value=data.locationDetail||'';
   locDetailInput.oninput=()=>{ data.locationDetail=locDetailInput.value; };
   locDetailField.appendChild(locDetailLabel);
   locDetailField.appendChild(locDetailInput);
   const hostField=document.createElement('div');
   hostField.className='rounded-md bg-gray-50 p-3';
   const hostLabel=document.createElement('div');
   hostLabel.className='text-xs text-gray-600';
   hostLabel.textContent='ä¸»æŒäºº';
   const hostInput=input();
   hostInput.value=data.host||'';
   hostInput.oninput=()=>{ data.host=hostInput.value; };
   hostField.appendChild(hostLabel);
   hostField.appendChild(hostInput);
   const participantsWrap=document.createElement('div');
   participantsWrap.className='rounded-lg border border-gray-200 bg-white p-3';
   const pHead=document.createElement('div');
   pHead.className='flex items-center justify-between mb-2';
   const pTitle=document.createElement('div');
   pTitle.className='text-xs font-medium';
   pTitle.textContent='å‚ä¸è€…åå•ï¼ˆç´§å‡‘è¡¨æ ¼ï¼‰';
   const addP=document.createElement('button');
   addP.className='text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   addP.textContent='æ·»åŠ å‚ä¸è€…';
   pHead.appendChild(pTitle);
   pHead.appendChild(addP);
   const pTable=document.createElement('div');
   pTable.className='grid grid-cols-12 gap-2';
   function renderParticipants(){
     pTable.innerHTML='';
     const header=['å§“å','èº«ä»½æ ‡ç­¾','æ ¸å¿ƒç‰¹å¾','æ“ä½œ'];
     const headerRow=document.createElement('div');
     headerRow.className='contents';
     [0,1,2,3].forEach((i)=>{
       const cell=document.createElement('div');
       cell.className='col-span-3 text-xs text-gray-600';
       cell.textContent=header[i];
       headerRow.appendChild(cell);
     });
     pTable.appendChild(headerRow);
     if(!data.participants||data.participants.length===0) data.participants=[];
     data.participants.forEach((p,idx)=>{
       const row=document.createElement('div');
       row.className='contents';
       const nameCell=document.createElement('div');
       nameCell.className='col-span-3';
       const nameInput=input();
       nameInput.value=p.name||'';
       nameInput.oninput=()=>{ p.name=nameInput.value; };
       nameCell.appendChild(nameInput);
       const tagCell=document.createElement('div');
       tagCell.className='col-span-3';
       const tagSelect=document.createElement('select');
       tagSelect.className='w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
       ['èµ„æ·±ç”¨æˆ·','æ½œåœ¨ç”¨æˆ·','æ–°ç”¨æˆ·','æµå¤±ç”¨æˆ·'].forEach(s=>{ const opt=document.createElement('option'); opt.value=s; opt.textContent=s; tagSelect.appendChild(opt); });
       tagSelect.value=p.tag||'èµ„æ·±ç”¨æˆ·';
       tagSelect.oninput=()=>{ p.tag=tagSelect.value; };
       tagCell.appendChild(tagSelect);
       const traitCell=document.createElement('div');
       traitCell.className='col-span-3';
       const traitInput=input();
       traitInput.placeholder='æ ¸å¿ƒç‰¹å¾æè¿°';
       traitInput.value=p.traits||'';
       traitInput.oninput=()=>{ p.traits=traitInput.value; };
       traitCell.appendChild(traitInput);
       const opCell=document.createElement('div');
       opCell.className='col-span-3';
       const del=document.createElement('button');
       del.className='text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
       del.textContent='åˆ é™¤';
       del.onclick=()=>{ data.participants.splice(idx,1); renderParticipants(); };
       opCell.appendChild(del);
       row.appendChild(nameCell);
       row.appendChild(tagCell);
       row.appendChild(traitCell);
       row.appendChild(opCell);
       pTable.appendChild(row);
     });
   }
   addP.onclick=()=>{ data.participants.push({name:'',tag:'èµ„æ·±ç”¨æˆ·',traits:''}); renderParticipants(); };
   renderParticipants();
   participantsWrap.appendChild(pHead);
   participantsWrap.appendChild(pTable);
   const outlineWrap=document.createElement('div');
   outlineWrap.className='rounded-lg border border-gray-200 bg-gray-50 p-3';
   const outlineHead=document.createElement('div');
   outlineHead.className='flex items-center justify-between mb-2';
   const outlineTitle=document.createElement('div');
   outlineTitle.className='text-xs font-medium';
   outlineTitle.textContent='è®¨è®ºå¤§çº²';
   const addOutline=document.createElement('button');
   addOutline.className='text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   addOutline.textContent='æ·»åŠ é—®é¢˜';
   outlineHead.appendChild(outlineTitle);
   outlineHead.appendChild(addOutline);
   const outlineList=document.createElement('div');
   outlineList.className='space-y-2';
   function renderOutline(){
     outlineList.innerHTML='';
     if(!data.outline||data.outline.length===0) data.outline=[];
     data.outline.forEach((q,idx)=>{
       const row=document.createElement('div');
       row.className='flex items-center gap-2';
       const qi=input('flex-1 rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none');
       qi.value=q||'';
       qi.oninput=()=>{ data.outline[idx]=qi.value; };
       const del=document.createElement('button');
       del.className='text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
       del.textContent='åˆ é™¤';
       del.onclick=()=>{ data.outline.splice(idx,1); renderOutline(); };
       row.appendChild(qi);
       row.appendChild(del);
       outlineList.appendChild(row);
     });
   }
   addOutline.onclick=()=>{ data.outline.push(''); renderOutline(); };
   renderOutline();
   outlineWrap.appendChild(outlineHead);
   outlineWrap.appendChild(outlineList);
   const recordsWrap=document.createElement('div');
   recordsWrap.className='rounded-lg border border-gray-200 bg-white p-3';
   const collisionLabel=document.createElement('div');
   collisionLabel.className='text-xs font-medium';
   collisionLabel.textContent='è§‚ç‚¹ç¢°æ’åŒº';
   const collisionText=textarea();
   collisionText.value=(data.records&&data.records.collision)||'';
   collisionText.oninput=()=>{ data.records=data.records||{}; data.records.collision=collisionText.value; };
   const consensusLabel=document.createElement('div');
   consensusLabel.className='text-xs font-medium mt-3';
   consensusLabel.textContent='å…±è¯†æ€»ç»“';
   const consensusText=textarea();
   consensusText.value=(data.records&&data.records.consensus)||'';
   consensusText.oninput=()=>{ data.records=data.records||{}; data.records.consensus=consensusText.value; };
   const quotesLabel=document.createElement('div');
   quotesLabel.className='text-xs font-medium mt-3';
   quotesLabel.textContent='ç²¾å½©é‡‘å¥ï¼ˆæç¤ºï¼šä½¿ç”¨ > è¡¨ç¤ºé‡‘å¥ï¼‰';
   const quotesText=textarea();
   quotesText.placeholder='ä¾‹å¦‚ï¼š> è¿™æ˜¯æŸä½å‚ä¸è€…çš„åŸè¯';
   quotesText.value=(data.records&&data.records.quotes)||'';
   quotesText.oninput=()=>{ data.records=data.records||{}; data.records.quotes=quotesText.value; };
   recordsWrap.appendChild(collisionLabel);
   recordsWrap.appendChild(collisionText);
   recordsWrap.appendChild(consensusLabel);
   recordsWrap.appendChild(consensusText);
   recordsWrap.appendChild(quotesLabel);
   recordsWrap.appendChild(quotesText);
   exportMD.onclick=()=>{ exportMarkdownFG(data); };
   exportDOC.onclick=()=>{ exportWordFG(data); };
   exportPDF.onclick=()=>{ buildPrintHTMLFG(data); alert('è¯·åœ¨å¼¹å‡ºçš„æ‰“å°çª—å£ä¸­é€‰æ‹©â€œå¦å­˜ä¸º PDFâ€'); window.print(); };
   const actions=document.createElement('div');
   actions.className='flex items-center gap-2';
   const saveBtn=document.createElement('button');
   saveBtn.className='text-sm px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   saveBtn.textContent='ä¿å­˜';
   const delBtn=document.createElement('button');
   delBtn.className='text-sm px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   delBtn.textContent='åˆ é™¤';
   actions.appendChild(saveBtn);
   if(editingId) actions.appendChild(delBtn);
   saveBtn.onclick=()=>{
     proj.focusLastModified=today();
     proj.focusUpdatedAt=nowMs();
     proj.updatedAt=nowMs();
     if(editingId){
       const idx=proj.focusGroups.findIndex(x=>x.id===editingId);
       if(idx>=0) proj.focusGroups[idx]=data;
     }else{
       proj.focusGroups.push(data);
       editingId=data.id;
     }
     save();
     renderList();
   };
   delBtn.onclick=()=>{
     if(!editingId) return;
     if(confirm('åˆ é™¤è¯¥ç„¦ç‚¹å°ç»„è®°å½•ï¼Ÿ')){
       proj.focusGroups=proj.focusGroups.filter(x=>x.id!==editingId);
       save();
       editingId=null;
       form.innerHTML='';
       renderList();
     }
   };
   form.appendChild(baseWrap);
   form.appendChild(infoWrap);
   form.appendChild(locDetailField);
   form.appendChild(hostField);
   form.appendChild(participantsWrap);
   form.appendChild(outlineWrap);
   form.appendChild(recordsWrap);
   form.appendChild(actions);
 }
 addBtn.onclick=()=>{ loadForm(null); };
 outlineBtn.onclick=()=>{ openOutlineModal(); };
 renderList();
}
function renderSurveyCategory(root, proj){
 const container=document.createElement('div');
 container.className='grid grid-cols-1 lg:grid-cols-3 gap-4';
 const listBox=document.createElement('div');
 listBox.className='lg:col-span-1 rounded-lg border border-gray-200 bg-white p-4';
 const listHead=document.createElement('div');
 listHead.className='flex items-center justify-between mb-3';
 const listTitle=document.createElement('div');
 listTitle.className='text-sm font-medium';
 listTitle.textContent='é—®å·åˆ—è¡¨';
 const addBtn=document.createElement('button');
 addBtn.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 addBtn.textContent='æ–°å¢é—®å·';
 listHead.appendChild(listTitle);
 listHead.appendChild(addBtn);
 const list=document.createElement('div');
 list.className='space-y-2';
 listBox.appendChild(listHead);
 listBox.appendChild(list);
 const formBox=document.createElement('div');
 formBox.className='lg:col-span-2 rounded-lg border border-gray-200 bg-gray-50 p-4';
 const formHead=document.createElement('div');
 formHead.className='flex items-center justify-between mb-3';
 const formTitle=document.createElement('div');
 formTitle.className='text-sm font-medium';
 formTitle.textContent='é—®å·è¯¦æƒ…';
 formHead.appendChild(formTitle);
 formBox.appendChild(formHead);
 const form=document.createElement('div');
 form.className='space-y-4';
 formBox.appendChild(form);
 container.appendChild(listBox);
 container.appendChild(formBox);
 root.appendChild(container);
 let editingId=null;
 function now(){
   const d=new Date();
   const yyyy=d.getFullYear();
   const mm=String(d.getMonth()+1).padStart(2,'0');
   const dd=String(d.getDate()).padStart(2,'0');
   const hh=String(d.getHours()).padStart(2,'0');
   const mi=String(d.getMinutes()).padStart(2,'0');
   return `${yyyy}-${mm}-${dd} ${hh}:${mi}`;
 }
 function today(){
   const d=new Date();
   const yyyy=d.getFullYear();
   const mm=String(d.getMonth()+1).padStart(2,'0');
   const dd=String(d.getDate()).padStart(2,'0');
   return `${yyyy}-${mm}-${dd}`;
 }
 function badge(status){
   const s=document.createElement('span');
   s.className='text-xs px-2 py-0.5 rounded border';
   s.textContent=status||'è®¾è®¡ä¸­';
   if(status==='æŠ•æ”¾ä¸­'){ s.className+=' border-green-300 text-green-700 bg-green-50'; }
   else if(status==='å·²ç»“æŸ'){ s.className+=' border-gray-300 text-gray-700 bg-gray-50'; }
   else { s.className+=' border-yellow-300 text-yellow-700 bg-yellow-50'; }
   return s;
 }
 function input(cls, placeholder){
   const i=document.createElement('input');
   i.className=cls || 'w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
   if(placeholder) i.placeholder=placeholder;
   return i;
 }
 function textarea(cls, placeholder){
   const t=document.createElement('textarea');
   t.className=cls || 'w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
   if(placeholder) t.placeholder=placeholder;
   return t;
 }
 function renderList(){
   list.innerHTML='';
   (proj.surveys||[]).forEach(item=>{
     const row=document.createElement('div');
     row.className='rounded border border-gray-200 px-3 py-2 hover:bg-gray-50';
     const top=document.createElement('div');
     top.className='flex items-center justify-between';
     const left=document.createElement('div');
     left.className='flex items-center gap-2';
     const nameBtn=document.createElement('button');
     nameBtn.className='text-sm font-medium';
     nameBtn.textContent=item.name||'æœªå‘½åé—®å·';
     nameBtn.onclick=()=>{ loadForm(item.id); };
     const st=badge(item.status||'è®¾è®¡ä¸­');
     left.appendChild(nameBtn);
     left.appendChild(st);
     const quick=document.createElement('button');
     quick.className=(item.adminLink&&item.adminLink.trim()? 'text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200' : 'text-xs px-2 py-1 rounded border border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed');
     quick.textContent='â†—ï¸ åå°';
     quick.title='ä¸€é”®è·³è½¬åå°';
     quick.onclick=(e)=>{
       e.stopPropagation();
       if(item.adminLink&&item.adminLink.trim()) window.open(item.adminLink,'_blank');
     };
     top.appendChild(left);
     top.appendChild(quick);
     const meta=document.createElement('div');
     meta.className='mt-1 text-xs text-gray-500';
     const planned=item.planned||0;
     const actual=item.actual||0;
     meta.textContent=`è¿›åº¦ï¼š${actual}/${planned} Â· æœ€åæ›´æ–°æ—¶é—´ï¼š${item.updatedAt||'-'}`;
     row.appendChild(top);
     row.appendChild(meta);
     list.appendChild(row);
   });
   if(!proj.surveys||proj.surveys.length===0){
     const empty=document.createElement('div');
     empty.className='text-xs text-gray-500';
     empty.textContent='æš‚æ— é—®å·ï¼Œç‚¹å‡»â€œæ–°å¢é—®å·â€å¼€å§‹æ·»åŠ ã€‚';
     list.appendChild(empty);
   }
 }
 function loadForm(id){
   form.innerHTML='';
   let data;
   if(id){
     data=proj.surveys.find(x=>x.id===id);
     editingId=id;
   }else{
     data={id:String(Date.now()),name:'',status:'è®¾è®¡ä¸­',planned:0,actual:0,updatedAt:now(),visitLink:'',adminLink:'',targetDesc:'',adminNote:'',insights:''};
     editingId=null;
   }
  if(!data.questions) data.questions=[{title:'',type:'å•é€‰',options:[]}];
   const entryWrap=document.createElement('div');
   entryWrap.className='rounded-md bg-gray-50 p-3';
   const entryHead=document.createElement('div');
   entryHead.className='text-xs text-gray-600 mb-2';
   entryHead.textContent='å…¥å£åŒº';
   const entryBtns=document.createElement('div');
   entryBtns.className='flex items-center gap-2';
   const openVisit=document.createElement('button');
   openVisit.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   openVisit.textContent='ğŸ”— æ‰“å¼€è®¿é—®é“¾æ¥';
   openVisit.onclick=()=>{ if(data.visitLink&&data.visitLink.trim()) window.open(data.visitLink,'_blank'); };
   const openAdmin=document.createElement('button');
   const hasAdmin=data.adminLink&&data.adminLink.trim();
   openAdmin.className=hasAdmin? 'text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200' : 'text-xs px-3 py-1.5 rounded border border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed';
   openAdmin.textContent='ğŸ› ï¸ ç®¡ç†åå°';
   if(hasAdmin) openAdmin.onclick=()=>{ window.open(data.adminLink,'_blank'); };
   entryBtns.appendChild(openVisit);
   entryBtns.appendChild(openAdmin);
   entryWrap.appendChild(entryHead);
   entryWrap.appendChild(entryBtns);
   const baseWrap=document.createElement('div');
   baseWrap.className='grid grid-cols-1 md:grid-cols-2 gap-3 rounded-md bg-gray-50 p-3';
   const nameField=document.createElement('div');
   const nameLabel=document.createElement('div');
   nameLabel.className='text-xs text-gray-600';
   nameLabel.textContent='é—®å·åç§°';
   const nameInput=input();
   nameInput.value=data.name||'';
   nameInput.oninput=()=>{ data.name=nameInput.value; };
   nameField.appendChild(nameLabel);
   nameField.appendChild(nameInput);
   const statusField=document.createElement('div');
   const statusLabel=document.createElement('div');
   statusLabel.className='text-xs text-gray-600';
   statusLabel.textContent='çŠ¶æ€';
   const statusSelect=document.createElement('select');
   statusSelect.className='w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
   ['è®¾è®¡ä¸­','æŠ•æ”¾ä¸­','å·²ç»“æŸ'].forEach(s=>{
     const opt=document.createElement('option');
     opt.value=s; opt.textContent=s;
     statusSelect.appendChild(opt);
   });
   statusSelect.value=data.status||'è®¾è®¡ä¸­';
   statusSelect.oninput=()=>{ data.status=statusSelect.value; };
   statusField.appendChild(statusLabel);
   statusField.appendChild(statusSelect);
   const linksWrap=document.createElement('div');
   linksWrap.className='grid grid-cols-1 md:grid-cols-2 gap-3 rounded-md bg-gray-50 p-3';
   const visitLabel=document.createElement('div');
   visitLabel.className='text-xs text-gray-600';
   visitLabel.textContent='è®¿é—®é“¾æ¥';
   const visitInput=input();
   visitInput.value=data.visitLink||'';
   visitInput.oninput=()=>{ data.visitLink=visitInput.value; };
   const adminLabel=document.createElement('div');
   adminLabel.className='text-xs text-gray-600';
   adminLabel.textContent='ç®¡ç†åå°é“¾æ¥';
   const adminInput=input();
   adminInput.value=data.adminLink||'';
   adminInput.oninput=()=>{ data.adminLink=adminInput.value; };
   const visitField=document.createElement('div');
   visitField.appendChild(visitLabel);
   visitField.appendChild(visitInput);
   const adminField=document.createElement('div');
   adminField.appendChild(adminLabel);
   adminField.appendChild(adminInput);
   linksWrap.appendChild(visitField);
   linksWrap.appendChild(adminField);
   const progressWrap=document.createElement('div');
   progressWrap.className='grid grid-cols-1 md:grid-cols-2 gap-3 rounded-md bg-gray-50 p-3';
   const plannedField=document.createElement('div');
   const plannedLabel=document.createElement('div');
   plannedLabel.className='text-xs text-gray-600';
   plannedLabel.textContent='è®¡åˆ’å›æ”¶é‡';
   const plannedInput=input();
   plannedInput.type='number';
   plannedInput.value=String(data.planned||0);
   plannedInput.oninput=()=>{ data.planned=parseInt(plannedInput.value||'0',10)||0; };
   plannedField.appendChild(plannedLabel);
   plannedField.appendChild(plannedInput);
   const actualField=document.createElement('div');
   const actualLabel=document.createElement('div');
   actualLabel.className='text-xs text-gray-600';
   actualLabel.textContent='å®é™…å›æ”¶é‡';
   const actualInput=input();
   actualInput.type='number';
   actualInput.value=String(data.actual||0);
   actualInput.oninput=()=>{ data.actual=parseInt(actualInput.value||'0',10)||0; };
   actualField.appendChild(actualLabel);
   actualField.appendChild(actualInput);
   progressWrap.appendChild(plannedField);
   progressWrap.appendChild(actualField);
   const infoWrap=document.createElement('div');
   infoWrap.className='rounded-md bg-gray-50 p-3';
   const targetLabel=document.createElement('div');
   targetLabel.className='text-xs text-gray-600';
   targetLabel.textContent='ç›®æ ‡äººç¾¤æè¿°';
   const targetText=textarea();
   targetText.value=data.targetDesc||'';
   targetText.oninput=()=>{ data.targetDesc=targetText.value; };
   const accountLabel=document.createElement('div');
   accountLabel.className='text-xs text-gray-600 mt-3';
   accountLabel.textContent='åå°è´¦å·å¤‡æ³¨';
   const accountText=textarea();
   accountText.value=data.adminNote||'';
   accountText.oninput=()=>{ data.adminNote=accountText.value; };
   infoWrap.appendChild(targetLabel);
   infoWrap.appendChild(targetText);
   infoWrap.appendChild(accountLabel);
   infoWrap.appendChild(accountText);
   const questionsWrap=document.createElement('div');
   questionsWrap.className='rounded-lg border border-gray-200 bg-[#FAFAFA] p-3';
   const qHead=document.createElement('div');
   qHead.className='flex items-center justify-between mb-2';
   const qTitle=document.createElement('div');
   qTitle.className='text-xs font-medium';
   qTitle.textContent='é¢˜ç›®ä¸é€‰é¡¹è®¾è®¡';
   const addQuestion=document.createElement('button');
   addQuestion.className='text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   addQuestion.textContent='æ·»åŠ é¢˜ç›®';
   qHead.appendChild(qTitle);
   qHead.appendChild(addQuestion);
   const questionsList=document.createElement('div');
   questionsList.className='space-y-3';
   questionsWrap.appendChild(qHead);
   questionsWrap.appendChild(questionsList);
   function renderQuestions(){
     questionsList.innerHTML='';
     if(!data.questions||data.questions.length===0) data.questions=[{title:'',type:'å•é€‰',options:[]}];
     data.questions.forEach((q,idx)=>{
       const card=document.createElement('div');
       card.className='relative rounded-md bg-white p-3 border border-gray-200';
       const del=document.createElement('button');
       del.className='absolute right-2 top-2 text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
       del.textContent='ğŸ—‘ï¸';
       del.onclick=()=>{
         data.questions.splice(idx,1);
         renderQuestions();
       };
       const qTextLabel=document.createElement('div');
       qTextLabel.className='text-xs text-gray-600';
       qTextLabel.textContent='é¢˜ç›®æ–‡å­—';
       const qTextInput=document.createElement('input');
       qTextInput.className='w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
       qTextInput.value=q.title||'';
       qTextInput.oninput=()=>{ q.title=qTextInput.value; };
       const typeLabel=document.createElement('div');
       typeLabel.className='text-xs text-gray-600 mt-3';
       typeLabel.textContent='é¢˜å‹';
       const typeSelect=document.createElement('select');
       typeSelect.className='w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
       ['å•é€‰','å¤šé€‰','å¡«ç©º'].forEach(t=>{
         const opt=document.createElement('option');
         opt.value=t; opt.textContent=t;
         typeSelect.appendChild(opt);
       });
       typeSelect.value=q.type||'å•é€‰';
       typeSelect.oninput=()=>{ q.type=typeSelect.value; renderQuestions(); };
       const optLabel=document.createElement('div');
       optLabel.className='text-xs text-gray-600 mt-3';
       optLabel.textContent='é€‰é¡¹å†…å®¹ï¼ˆæ¯è¡Œä¸€ä¸ªé€‰é¡¹ï¼‰';
       const optText=document.createElement('textarea');
       optText.className='w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
       optText.placeholder='æ¯è¡Œè¾“å…¥ä¸€ä¸ªé€‰é¡¹';
       optText.value=(q.options||[]).join('\\n');
       optText.oninput=()=>{ q.options=optText.value.split('\\n').map(x=>x.trim()).filter(x=>x.length>0); };
       const optBlock=document.createElement('div');
       optBlock.appendChild(optLabel);
       optBlock.appendChild(optText);
       if(typeSelect.value==='å¡«ç©º') optBlock.classList.add('hidden');
       card.appendChild(del);
       card.appendChild(qTextLabel);
       card.appendChild(qTextInput);
       card.appendChild(typeLabel);
       card.appendChild(typeSelect);
       card.appendChild(optBlock);
       questionsList.appendChild(card);
     });
   }
   addQuestion.onclick=()=>{
     data.questions.push({title:'',type:'å•é€‰',options:[]});
     renderQuestions();
   };
   renderQuestions();
   const insightWrap=document.createElement('div');
   insightWrap.className='rounded-lg border border-gray-200 bg-gray-100 p-3';
   const insightLabel=document.createElement('div');
   insightLabel.className='text-xs font-medium mb-2';
   insightLabel.textContent='æ ¸å¿ƒæ´å¯Ÿï¼ˆæ‰‹åŠ¨æ¬è¿åˆ†æç»“æœï¼‰';
   const insightText=textarea();
   insightText.value=data.insights||'';
   insightText.oninput=()=>{ data.insights=insightText.value; };
   insightWrap.appendChild(insightLabel);
   insightWrap.appendChild(insightText);
   const meta=document.createElement('div');
   meta.className='text-xs text-gray-500';
   meta.textContent=`æœ€åæ›´æ–°æ—¶é—´ï¼š${data.updatedAt||'-'}`;
   const actions=document.createElement('div');
   actions.className='flex items-center gap-2';
   const saveBtn=document.createElement('button');
   saveBtn.className='text-sm px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   saveBtn.textContent='ä¿å­˜';
   const delBtn=document.createElement('button');
   delBtn.className='text-sm px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   delBtn.textContent='åˆ é™¤';
   actions.appendChild(saveBtn);
   if(editingId) actions.appendChild(delBtn);
   saveBtn.onclick=()=>{
     data.updatedAt=now();
     proj.surveyLastModified=today();
    proj.surveyUpdatedAt=nowMs();
    proj.updatedAt=nowMs();
     if(editingId){
       const idx=proj.surveys.findIndex(x=>x.id===editingId);
       if(idx>=0) proj.surveys[idx]=data;
     }else{
       proj.surveys.push(data);
       editingId=data.id;
     }
     save();
     meta.textContent=`æœ€åæ›´æ–°æ—¶é—´ï¼š${data.updatedAt||'-'}`;
     renderList();
   };
   delBtn.onclick=()=>{
     if(!editingId) return;
     if(confirm('åˆ é™¤è¯¥é—®å·è®°å½•ï¼Ÿ')){
       proj.surveys=proj.surveys.filter(x=>x.id!==editingId);
       save();
       editingId=null;
       form.innerHTML='';
       renderList();
     }
   };
   form.appendChild(entryWrap);
   form.appendChild(baseWrap);
   form.appendChild(linksWrap);
   form.appendChild(progressWrap);
   form.appendChild(infoWrap);
   form.appendChild(questionsWrap);
   form.appendChild(insightWrap);
   form.appendChild(meta);
   form.appendChild(actions);
 }
 addBtn.onclick=()=>{ loadForm(null); };
  renderList();
  if(_openTarget && _openTarget.type==='survey'){ loadForm(_openTarget.id); _openTarget=null; }
}
 function renderInterviewCategory(root, proj){
 const container=document.createElement('div');
 container.className='grid grid-cols-1 lg:grid-cols-3 gap-4';
 const listBox=document.createElement('div');
 listBox.className='lg:col-span-1 rounded-lg border border-gray-200 bg-white p-4';
 const listHead=document.createElement('div');
 listHead.className='flex items-center justify-between mb-3';
 const listTitle=document.createElement('div');
 listTitle.className='text-sm font-medium';
 listTitle.textContent='è®¿è°ˆè®°å½•';
 const headActions=document.createElement('div');
 headActions.className='flex items-center gap-2';
 const outlineBtn=document.createElement('button');
 outlineBtn.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 outlineBtn.textContent='ç¼–è¾‘é»˜è®¤æçº²';
 const addBtn=document.createElement('button');
 addBtn.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 addBtn.textContent='æ–°å¢è®¿è°ˆ';
 listHead.appendChild(listTitle);
 headActions.appendChild(outlineBtn);
 headActions.appendChild(addBtn);
 listHead.appendChild(headActions);
 const list=document.createElement('div');
 list.className='space-y-2';
 listBox.appendChild(listHead);
 listBox.appendChild(list);
 const formBox=document.createElement('div');
 formBox.className='lg:col-span-2 rounded-lg border border-gray-200 bg-gray-50 p-4';
 const formHead=document.createElement('div');
 formHead.className='flex items-center justify-between mb-3 no-print';
 const formTitle=document.createElement('div');
 formTitle.className='text-sm font-medium';
 formTitle.textContent='è®¿è°ˆè¯¦æƒ…';
 const exportGroup=document.createElement('div');
 exportGroup.className='export-group flex items-center gap-2';
 const exportMD=document.createElement('button');
 exportMD.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 exportMD.textContent='ğŸ“¥ å¯¼å‡º MD';
 const exportDOC=document.createElement('button');
 exportDOC.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 exportDOC.textContent='ğŸ“ å¯¼å‡º Word';
 const exportPDF=document.createElement('button');
 exportPDF.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 exportPDF.textContent='ğŸ–¨ï¸ æ‰“å°/å¯¼å‡º PDF';
 exportGroup.appendChild(exportMD);
 exportGroup.appendChild(exportDOC);
 exportGroup.appendChild(exportPDF);
 formHead.appendChild(formTitle);
 formHead.appendChild(exportGroup);
 formBox.appendChild(formHead);
 const form=document.createElement('div');
 form.className='space-y-4';
 formBox.appendChild(form);
 const printArea=document.createElement('div');
 printArea.id='printArea';
 printArea.className='hidden';
 formBox.appendChild(printArea);
 container.appendChild(listBox);
 container.appendChild(formBox);
 root.appendChild(container);
 let editingId=null;
 function openOutlineModal(){
   const overlay=document.createElement('div');
   overlay.className='fixed inset-0 bg-black/20 flex items-center justify-center z-50';
   const panel=document.createElement('div');
   panel.className='w-full max-w-lg rounded-lg border border-gray-200 bg-white p-4';
   const title=document.createElement('div');
   title.className='text-sm font-medium mb-2';
   title.textContent='ç¼–è¾‘é»˜è®¤æçº²ï¼ˆæ¯è¡Œä¸€ä¸ªé—®é¢˜ï¼‰';
   const ta=document.createElement('textarea');
   ta.className='w-full h-48 rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
   ta.value=(proj.interviewTemplate||[]).join('\n');
   const actions=document.createElement('div');
   actions.className='mt-3 flex items-center justify-end gap-2';
   const cancel=document.createElement('button');
   cancel.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   cancel.textContent='å–æ¶ˆ';
   const saveBtn=document.createElement('button');
   saveBtn.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   saveBtn.textContent='ä¿å­˜';
   actions.appendChild(cancel);
   actions.appendChild(saveBtn);
   panel.appendChild(title);
   panel.appendChild(ta);
   panel.appendChild(actions);
   overlay.appendChild(panel);
   document.body.appendChild(overlay);
   cancel.onclick=()=>{ document.body.removeChild(overlay); };
   saveBtn.onclick=()=>{
     const lines=ta.value.split('\n').map(x=>x.trim()).filter(x=>x.length>0);
     proj.interviewTemplate=lines;
     save();
     document.body.removeChild(overlay);
   };
 }
 function today(){
   const d=new Date();
   const yyyy=d.getFullYear();
   const mm=String(d.getMonth()+1).padStart(2,'0');
   const dd=String(d.getDate()).padStart(2,'0');
   return `${yyyy}-${mm}-${dd}`;
 }
 function input(cls, placeholder){
   const i=document.createElement('input');
   i.className=cls || 'w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
   if(placeholder) i.placeholder=placeholder;
   return i;
 }
 function textarea(cls, placeholder){
   const t=document.createElement('textarea');
   t.className=cls || 'w-full rounded px-3 py-2 text-sm bg-white border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none';
   if(placeholder) t.placeholder=placeholder;
   return t;
 }
function exportWord(current){
  const n=current.name && current.name.trim()? current.name.trim(): 'æœªå‘½å';
  const d=current.date && current.date.trim()? current.date.trim(): today();
  const safe=s=>s.replace(/[\\/:*?"<>|]/g,'_');
  const fname=`è®¿è°ˆè®°å½•_${safe(n)}_${safe(d)}.doc`;
  const html=`<!doctype html>
<html><head><meta charset="utf-8">
<title>è®¿è°ˆè®°å½•</title>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei","Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;line-height:1.6}
h1{font-size:20px;font-weight:700;margin:0 0 8px}
h2{font-size:16px;font-weight:700;margin:16px 0 6px}
p{margin:6px 0}
.block{margin:10px 0;padding:8px;border:1px solid #e5e7eb;border-radius:6px;background:#fafafa}
.qa{margin:10px 0;padding:8px;border-left:3px solid #e5e7eb}
.q{font-weight:600;margin-bottom:4px}
.a{margin-left:0}
</style></head><body>
<h1>è®¿è°ˆè®°å½•ï¼š${n}</h1>
<p>æ—¥æœŸï¼š${d}</p>
<div class="block"><h2>ç”¨æˆ·èƒŒæ™¯</h2><p>${(current.background||'').replace(/</g,'&lt;')}</p></div>
<div class="block"><h2>æ ¸å¿ƒç—›ç‚¹</h2><p>${(current.pain||'').replace(/</g,'&lt;')}</p></div>
<h2>è®¿è°ˆè¯¦æƒ…</h2>
${(current.notes||[]).map(pair=>`
<div class="qa">
  <div class="q">Q: ${((pair.question||'').replace(/</g,'&lt;'))}</div>
  <div class="a">A: ${((pair.answer||'').replace(/</g,'&lt;'))}</div>
</div>`).join('')}
<div class="block"><h2>å¤‡æ³¨</h2><p>${(current.remark||'').replace(/</g,'&lt;')}</p></div>
</body></html>`;
  const blob=new Blob([html],{type:'application/msword;charset=utf-8'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=fname;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}
function buildPrintHTML(current){
  const n=current.name && current.name.trim()? current.name.trim(): 'æœªå‘½å';
  const d=current.date && current.date.trim()? current.date.trim(): today();
  const printArea=document.getElementById('printArea');
  if(!printArea) return;
  printArea.innerHTML=`
  <div style="padding:24px;font-family:-apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei','Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif">
    <h1 style="font-size:20px;font-weight:700;margin:0 0 8px">è®¿è°ˆè®°å½•ï¼š${n}</h1>
    <p style="margin:6px 0">æ—¥æœŸï¼š${d}</p>
    <div style="margin:10px 0;padding:8px;border:1px solid #e5e7eb;border-radius:6px;background:#fafafa">
      <h2 style="font-size:16px;font-weight:700;margin:0 0 6px">ç”¨æˆ·èƒŒæ™¯</h2>
      <p>${(current.background||'').replace(/</g,'&lt;')}</p>
    </div>
    <div style="margin:10px 0;padding:8px;border:1px solid #e5e7eb;border-radius:6px;background:#fafafa">
      <h2 style="font-size:16px;font-weight:700;margin:0 0 6px">æ ¸å¿ƒç—›ç‚¹</h2>
      <p>${(current.pain||'').replace(/</g,'&lt;')}</p>
    </div>
    <h2 style="font-size:16px;font-weight:700;margin:16px 0 6px">è®¿è°ˆè¯¦æƒ…</h2>
    ${(current.notes||[]).map(pair=>`
      <div style="margin:10px 0;padding:8px;border-left:3px solid #e5e7eb">
        <div style="font-weight:600;margin-bottom:4px">Q: ${((pair.question||'').replace(/</g,'&lt;'))}</div>
        <div>A: ${((pair.answer||'').replace(/</g,'&lt;'))}</div>
      </div>`).join('')}
    <div style="margin:10px 0;padding:8px;border:1px solid #e5e7eb;border-radius:6px;background:#fafafa">
      <h2 style="font-size:16px;font-weight:700;margin:0 0 6px">å¤‡æ³¨</h2>
      <p>${(current.remark||'').replace(/</g,'&lt;')}</p>
    </div>
  </div>`;
}
 function exportMarkdown(current){
   const n=current.name && current.name.trim()? current.name.trim(): 'æœªå‘½å';
   const d=current.date && current.date.trim()? current.date.trim(): today();
   let md='';
   md+=`è®¿è°ˆè®°å½•ï¼š${n}\n`;
   md+=`æ—¥æœŸï¼š${d}\n\n`;
   md+=`ç”¨æˆ·èƒŒæ™¯ï¼š${(current.background||'').trim()}\n\n`;
   md+=`æ ¸å¿ƒç—›ç‚¹ï¼š${(current.pain||'').trim()}\n\n`;
   md+=`è®¿è°ˆè¯¦æƒ…\n`;
   (current.notes||[]).forEach(pair=>{
     const q=(pair.question||'').trim();
     const a=(pair.answer||'').trim();
     md+=`\nQ: ${q}\n\nA: ${a}\n`;
   });
   md+=`\nå¤‡æ³¨ï¼š${(current.remark||'').trim()}\n`;
   const safe=s=>s.replace(/[\\/:*?"<>|]/g,'_');
   const fname=`è®¿è°ˆè®°å½•_${safe(n)}_${safe(d)}.md`;
   const blob=new Blob([md],{type:'text/markdown;charset=utf-8'});
   const url=URL.createObjectURL(blob);
   const a=document.createElement('a');
   a.href=url;
   a.download=fname;
   document.body.appendChild(a);
   a.click();
   a.remove();
   URL.revokeObjectURL(url);
 }
 function renderList(){
   list.innerHTML='';
   proj.interviews.forEach(item=>{
     const row=document.createElement('button');
     row.className='w-full text-left rounded border border-gray-200 px-3 py-2 hover:bg-gray-50';
     row.innerHTML=`<div class="text-sm font-medium">${item.name||'æœªå‘½å'}</div><div class="text-xs text-gray-500 mt-0.5">${item.date||''}</div>`;
     row.onclick=()=>{ loadForm(item.id); };
     list.appendChild(row);
   });
   if(proj.interviews.length===0){
     const empty=document.createElement('div');
     empty.className='text-xs text-gray-500';
     empty.textContent='æš‚æ— è®¿è°ˆè®°å½•ï¼Œç‚¹å‡»â€œæ–°å¢è®¿è°ˆâ€å¼€å§‹æ·»åŠ ã€‚';
     list.appendChild(empty);
   }
 }
 function loadForm(id){
   form.innerHTML='';
   let data;
   if(id){
     data=proj.interviews.find(x=>x.id===id);
     editingId=id;
   }else{
    const templ=(proj.interviewTemplate||[]);
    data={id:String(Date.now()),name:'',date:today(),background:'',pain:'',remark:'',notes:(templ.length? templ.map(q=>({question:q,answer:''})):[{question:'',answer:''}])};
     editingId=null;
   }
 const row1=document.createElement('div');
 row1.className='grid grid-cols-1 md:grid-cols-2 gap-3 rounded-md bg-gray-50 p-3';
   const nameLabel=document.createElement('div');
   nameLabel.className='text-xs text-gray-600';
   nameLabel.textContent='å§“å';
   const nameInput=input();
   nameInput.value=data.name||'';
  nameInput.oninput=()=>{ data.name=nameInput.value; };
   const dateLabel=document.createElement('div');
   dateLabel.className='text-xs text-gray-600';
   dateLabel.textContent='æ—¥æœŸ';
   const dateInput=input();
   dateInput.type='date';
   dateInput.value=data.date||today();
  dateInput.oninput=()=>{ data.date=dateInput.value; };
   const nameField=document.createElement('div');
   nameField.appendChild(nameLabel);
   nameField.appendChild(nameInput);
   const dateField=document.createElement('div');
   dateField.appendChild(dateLabel);
   dateField.appendChild(dateInput);
   row1.appendChild(nameField);
   row1.appendChild(dateField);
 const bgField=document.createElement('div');
 bgField.className='rounded-md bg-gray-50 p-3';
   const bgLabel=document.createElement('div');
   bgLabel.className='text-xs text-gray-600';
   bgLabel.textContent='ç”¨æˆ·èƒŒæ™¯';
   const bgText=textarea();
   bgText.value=data.background||'';
  bgText.oninput=()=>{ data.background=bgText.value; };
   const bgHint=document.createElement('div');
   bgHint.className='text-xs text-gray-400 mt-1';
   bgHint.textContent='è¯·æè¿°ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€ä½¿ç”¨åœºæ™¯åŠèŒä¸šèƒŒæ™¯';
   bgField.appendChild(bgLabel);
   bgField.appendChild(bgText);
   bgField.appendChild(bgHint);
 const painField=document.createElement('div');
 painField.className='rounded-md bg-gray-50 p-3';
   const painLabel=document.createElement('div');
   painLabel.className='text-xs text-gray-600';
   painLabel.textContent='æ ¸å¿ƒç—›ç‚¹';
   const painText=textarea();
   painText.value=data.pain||'';
  painText.oninput=()=>{ data.pain=painText.value; };
   painField.appendChild(painLabel);
   painField.appendChild(painText);
 const remarkField=document.createElement('div');
 remarkField.className='rounded-md bg-gray-50 p-3';
   const remarkLabel=document.createElement('div');
   remarkLabel.className='text-xs text-gray-600';
   remarkLabel.textContent='å¤‡æ³¨';
   const remarkText=textarea();
   remarkText.value=data.remark||'';
  remarkText.oninput=()=>{ data.remark=remarkText.value; };
   remarkField.appendChild(remarkLabel);
   remarkField.appendChild(remarkText);
 const notesWrap=document.createElement('div');
 notesWrap.className='rounded-lg border border-gray-200 bg-gray-100 p-3';
   const notesHead=document.createElement('div');
   notesHead.className='flex items-center justify-between mb-2';
   const notesTitle=document.createElement('div');
   notesTitle.className='text-xs font-medium';
   notesTitle.textContent='è¯¦ç»†ç¬”è®°ï¼ˆé—®é¢˜-å›ç­”ï¼‰';
   const addPoint=document.createElement('button');
   addPoint.className='text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   addPoint.textContent='æ·»åŠ è®¿è°ˆç‚¹';
   notesHead.appendChild(notesTitle);
   notesHead.appendChild(addPoint);
   const notesList=document.createElement('div');
   notesList.className='space-y-3';
   notesWrap.appendChild(notesHead);
   notesWrap.appendChild(notesList);
   function renderNotes(){
     notesList.innerHTML='';
     if(!data.notes||data.notes.length===0) data.notes=[{question:'',answer:''}];
     data.notes.forEach((pair,idx)=>{
       const item=document.createElement('div');
      item.className='grid grid-cols-1 md:grid-cols-2 gap-3';
       const qField=document.createElement('div');
       const qLabel=document.createElement('div');
       qLabel.className='text-xs text-gray-600';
       qLabel.textContent=`é—®é¢˜ ${idx+1}`;
      const qInput=input('w-full rounded px-3 py-2 text-sm bg-gray-50 border border-transparent focus:border-blue-300 focus:ring-1 focus:ring-blue-200 outline-none font-medium');
       qInput.value=pair.question||'';
       qField.appendChild(qLabel);
       qField.appendChild(qInput);
       const aField=document.createElement('div');
       const aLabel=document.createElement('div');
       aLabel.className='text-xs text-gray-600';
       aLabel.textContent=`å›ç­” ${idx+1}`;
       const aInput=textarea();
       aInput.value=pair.answer||'';
       aField.appendChild(aLabel);
       aField.appendChild(aInput);
       qInput.oninput=()=>{ pair.question=qInput.value; };
       aInput.oninput=()=>{ pair.answer=aInput.value; };
      const remove=document.createElement('button');
      remove.className='justify-self-start md:justify-self-end text-xs px-2 py-1 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
      remove.textContent='åˆ é™¤è¯¥é¡¹';
      remove.onclick=()=>{
        data.notes.splice(idx,1);
        renderNotes();
      };
       item.appendChild(qField);
       item.appendChild(aField);
      item.appendChild(remove);
       notesList.appendChild(item);
     });
   }
   addPoint.onclick=()=>{
     data.notes.push({question:'',answer:''});
     renderNotes();
   };
   renderNotes();
  exportMD.onclick=()=>{ exportMarkdown(data); };
  exportDOC.onclick=()=>{ exportWord(data); };
  exportPDF.onclick=()=>{ buildPrintHTML(data); alert('è¯·åœ¨å¼¹å‡ºçš„æ‰“å°çª—å£ä¸­é€‰æ‹©â€œå¦å­˜ä¸º PDFâ€'); window.print(); };
   const actions=document.createElement('div');
   actions.className='flex items-center gap-2';
   const saveBtn=document.createElement('button');
   saveBtn.className='text-sm px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   saveBtn.textContent='ä¿å­˜';
   const delBtn=document.createElement('button');
   delBtn.className='text-sm px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
   delBtn.textContent='åˆ é™¤';
   actions.appendChild(saveBtn);
   if(editingId) actions.appendChild(delBtn);
   saveBtn.onclick=()=>{
     data.name=nameInput.value.trim();
     data.date=dateInput.value||today();
     data.background=bgText.value;
     data.pain=painText.value;
     data.remark=remarkText.value;
    proj.interviewLastModified=today();
    proj.interviewUpdatedAt=nowMs();
    proj.updatedAt=nowMs();
     if(editingId){
       const idx=proj.interviews.findIndex(x=>x.id===editingId);
       if(idx>=0) proj.interviews[idx]=data;
     }else{
       proj.interviews.push(data);
       editingId=data.id;
     }
     save();
     renderList();
   };
   delBtn.onclick=()=>{
     if(!editingId) return;
     if(confirm('åˆ é™¤è¯¥è®¿è°ˆè®°å½•ï¼Ÿ')){
       proj.interviews=proj.interviews.filter(x=>x.id!==editingId);
       save();
       editingId=null;
       form.innerHTML='';
       renderList();
     }
   };
   form.appendChild(row1);
   form.appendChild(bgField);
   form.appendChild(painField);
   form.appendChild(remarkField);
   form.appendChild(notesWrap);
   form.appendChild(actions);
 }
 addBtn.onclick=()=>{ loadForm(null); };
 outlineBtn.onclick=()=>{ openOutlineModal(); };
 renderList();
 if(_openTarget && _openTarget.type==='interview'){ loadForm(_openTarget.id); _openTarget=null; }
}
function createProject(){
 const val=prompt('æ–°å»ºé¡¹ç›®åç§°');
 if(!val||!val.trim()) return;
 const id=String(Date.now());
 projects.push({id,name:val.trim(),title:val.trim(),description:'',insights:'',updatedAt:Date.now(),surveyUpdatedAt:0,interviewUpdatedAt:0,focusUpdatedAt:0});
 selected=id;
 save(); render();
}
function render(){
 renderProjects();
 renderContent();
}
function showAboutModal(){
 const overlay=document.createElement('div');
 overlay.className='fixed inset-0 bg-black/20 flex items-center justify-center z-50';
 const panel=document.createElement('div');
 panel.className='w-full max-w-md rounded-lg border border-gray-200 bg-white p-4';
 const title=document.createElement('div');
 title.className='text-sm font-medium mb-2';
 title.textContent='ä½œå“è¯´æ˜';
 const body=document.createElement('div');
 body.className='text-sm text-gray-700';
 body.innerHTML='1. å¼€å‘èƒŒæ™¯<br/>æœ¬é¡¹ç›®ç”±äº§å“ç»ç†-ç™»ç™»é€šè¿‡ Trae (AI é©±åŠ¨) å®Œæˆå¼€å‘ï¼Œæ—¨åœ¨å°†ç”¨æˆ·ç ”ç©¶æ•°æ®ï¼ˆè®¿è°ˆã€é—®å·ã€ç„¦ç‚¹å°ç»„ï¼‰æ•£è½åœ¨æ–‡æ¡£ã€è¡¨æ ¼åŠç¬¬ä¸‰æ–¹å¹³å°å¯¼è‡´çš„ä¿¡æ¯å­¤å²›é—®é¢˜ã€‚ é€šè¿‡ç»“æ„åŒ–çš„é¡¹ç›®ç®¡ç†é€»è¾‘ï¼Œå®ç°ç”¨æˆ·è°ƒç ”èµ„äº§çš„æ²‰æ·€ä¸å¤ç”¨ã€‚<br/><br/>2. æŠ€æœ¯æ ˆ (Technical Stack)<br/>æœ¬é¡¹ç›®é‡‡ç”¨ Vibe Coding æ¨¡å¼ï¼ŒAI åä½œå®Œæˆä»£ç å®ç°ï¼š<br/>å‰ç«¯æ¡†æ¶ï¼šHTML5 + Tailwind CSS (å®ç°æç®€ Notion é£æ ¼ UI)ã€‚<br/>å¼€å‘å·¥å…·ï¼šTraeã€‚<br/>æ•°æ®å­˜å‚¨ï¼šLocalStorage (è½»é‡çº§æœ¬åœ°åŒ–å­˜å‚¨ï¼Œä¿æŠ¤å•†ä¸šè°ƒç ”éšç§)ã€‚<br/>éƒ¨ç½²å¹³å°ï¼šVercel / é˜¿é‡Œäº‘ OSS (å®ç°é™æ€èµ„æºçš„æé€Ÿè®¿é—®)ã€‚';
 const actions=document.createElement('div');
 actions.className='mt-3 flex items-center justify-end';
 const close=document.createElement('button');
 close.className='text-xs px-3 py-1.5 rounded border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200';
 close.textContent='å…³é—­';
 actions.appendChild(close);
 panel.appendChild(title);
 panel.appendChild(body);
 panel.appendChild(actions);
 overlay.appendChild(panel);
 document.body.appendChild(overlay);
 close.onclick=()=>{ document.body.removeChild(overlay); };
 overlay.onclick=(e)=>{ if(e.target===overlay){ document.body.removeChild(overlay); } };
}
document.getElementById('createProject').onclick=createProject;
document.getElementById('goHome').onclick=()=>{ selected=null; save(); render(); };
document.getElementById('backupBtn').onclick=()=>{
 const data={projects};
 const d=new Date();
 const yyyy=d.getFullYear();
 const mm=String(d.getMonth()+1).padStart(2,'0');
 const dd=String(d.getDate()).padStart(2,'0');
 const fname=`ç”¨æˆ·ç ”ç©¶æ•°æ®å¤‡ä»½_${yyyy}-${mm}-${dd}.json`;
 const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json;charset=utf-8'});
 const url=URL.createObjectURL(blob);
 const a=document.createElement('a');
 a.href=url; a.download=fname; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
};
document.getElementById('restoreBtn').onclick=()=>{
 const ok=confirm('æ­¤æ“ä½œå°†æ›¿æ¢å½“å‰æ‰€æœ‰æ•°æ®ï¼Œå»ºè®®å…ˆå¯¼å‡ºå½“å‰æ•°æ®å¤‡ä»½ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ');
 if(!ok) return;
 document.getElementById('restoreInput').click();
};
document.getElementById('restoreInput').onchange=(e)=>{
 const file=e.target.files && e.target.files[0];
 if(!file) return;
 const reader=new FileReader();
 reader.onload=()=>{
   try{
     const obj=JSON.parse(String(reader.result||'{}'));
     if(obj && obj.projects){
       localStorage.setItem(LS_KEY,JSON.stringify(obj.projects));
       localStorage.setItem(LS_SELECTED,'');
       location.reload();
     }else{
       alert('å¤‡ä»½æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
     }
   }catch(err){
     alert('è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶å†…å®¹');
   }
 };
 reader.readAsText(file);
};
document.getElementById('aboutBtn').onclick=()=>{ showAboutModal(); };
load();
render();
</script>
</body>
</html>
